<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Interactive Incident Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial; margin: 20px; background: #f4f4f4; }
    h1 { text-align: center; }
    .kpi-container { display: flex; gap: 20px; margin-bottom: 20px; }
    .kpi { background: white; padding: 15px; border-radius: 8px; flex: 1; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .filters { display: flex; gap: 15px; margin-bottom: 20px; }
    select { padding: 8px; }
    .chart-container { width: 48%; display: inline-block; margin-bottom: 30px; }
  </style>
</head>

<body>

<h1>Interactive Dashboard</h1>

<!-- KPI CARDS -->
<div class="kpi-container">
  <div class="kpi"><h2 id="kpiTotal">0</h2>Total Tickets</div>
  <div class="kpi"><h2 id="kpiInc">0</h2>Incidents</div>
  <div class="kpi"><h2 id="kpiSR">0</h2>Service Requests</div>
  <div class="kpi"><h2 id="kpiSCTask">0</h2>SC Tasks</div>
  <div class="kpi"><h2 id="kpiOnHold">0%</h2>On-Hold %</div>
</div>

<!-- FILTERS -->
<div class="filters">
  <select id="filterType"></select>
  <select id="filterStatus"></select>
  <select id="filterGroup"></select>
</div>

<!-- CHARTS -->
<div class="chart-container"><canvas id="chartStatus"></canvas></div>
<div class="chart-container"><canvas id="chartGroup"></canvas></div>
<div class="chart-container"><canvas id="chartPriority"></canvas></div>
<div class="chart-container"><canvas id="chartType"></canvas></div>
<div class="chart-container"><canvas id="chartService"></canvas></div>

<script>
/* -----------------------------
   INSERT YOUR DATA HERE
   Replace sampleData with your dataset
--------------------------------*/
const sampleData = [
  { number:"INC0379701", type:"INC", status:"On Hold", priority:"Low", group:"Finance", service:"3E" },
  { number:"INC0381759", type:"INC", status:"On Hold", priority:"Low", group:"SP/PP", service:"OneDrive" },
  { number:"SREQT0471536", type:"SR", status:"Work in Progress", priority:"Low", group:"Legal Tools", service:"Security" },
  { number:"SCTASK0093076", type:"SCTASK", status:"Pending", priority:"Low", group:"Legal Tools", service:"Access" }
];

/* -----------------------------
   POPULATE FILTERS
--------------------------------*/
function populateFilters() {
  const typeSet = new Set(["All"]);
  const statusSet = new Set(["All"]);
  const groupSet = new Set(["All"]);

  sampleData.forEach(d => {
    typeSet.add(d.type);
    statusSet.add(d.status);
    groupSet.add(d.group);
  });

  fillSelect("filterType", typeSet);
  fillSelect("filterStatus", statusSet);
  fillSelect("filterGroup", groupSet);
}

function fillSelect(id, values) {
  const sel = document.getElementById(id);
  sel.innerHTML = "";
  values.forEach(v => {
    const opt = document.createElement("option");
    opt.value = v;
    opt.textContent = v;
    sel.appendChild(opt);
  });
}

/* -----------------------------
   FILTER DATA
--------------------------------*/
function getFiltered() {
  const t = document.getElementById("filterType").value;
  const s = document.getElementById("filterStatus").value;
  const g = document.getElementById("filterGroup").value;

  return sampleData.filter(d =>
    (t === "All" || d.type === t) &&
    (s === "All" || d.status === s) &&
    (g === "All" || d.group === g)
  );
}

/* -----------------------------
   UPDATE KPIs
--------------------------------*/
function updateKPIs(data) {
  document.getElementById("kpiTotal").textContent = data.length;
  document.getElementById("kpiInc").textContent = data.filter(d => d.type === "INC").length;
  document.getElementById("kpiSR").textContent = data.filter(d => d.type === "SR").length;
  document.getElementById("kpiSCTask").textContent = data.filter(d => d.type === "SCTASK").length;

  const onHold = data.filter(d => d.status.includes("Hold")).length;
  document.getElementById("kpiOnHold").textContent = Math.round((onHold / data.length) * 100) + "%";
}

/* -----------------------------
   CHART HELPERS
--------------------------------*/
function countBy(data, key) {
  const map = {};
  data.forEach(d => map[d[key]] = (map[d[key]] || 0) + 1);
  return map;
}

let charts = [];

function updateCharts(data) {
  charts.forEach(c => c.destroy());
  charts = [];

  charts.push(makeChart("chartStatus", countBy(data, "status"), "Status"));
  charts.push(makeChart("chartGroup", countBy(data, "group"), "Assignment Group"));
  charts.push(makeChart("chartPriority", countBy(data, "priority"), "Priority"));
  charts.push(makeChart("chartType", countBy(data, "type"), "Type"));
  charts.push(makeChart("chartService", countBy(data, "service"), "Service"));
}

function makeChart(canvasId, map, label) {
  return new Chart(document.getElementById(canvasId), {
    type: "bar",
    data: {
      labels: Object.keys(map),
      datasets: [{
        label,
        data: Object.values(map),
        backgroundColor: "#4e73df"
      }]
    }
  });
}

/* -----------------------------
   MAIN REFRESH
--------------------------------*/
function refresh() {
  const filtered = getFiltered();
  updateKPIs(filtered);
  updateCharts(filtered);
}

document.getElementById("filterType").onchange = refresh;
document.getElementById("filterStatus").onchange = refresh;
document.getElementById("filterGroup").onchange = refresh;

populateFilters();
refresh();
</script>

</body>
</html>
